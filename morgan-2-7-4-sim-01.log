----------------------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  /Users/stephenmorgan/GitHub/steve-simulations/morgan-2-7-4-sim-01.log
  log type:  text
 opened on:  21 Aug 2020, 16:49:12

. 
. ********************************************************************************
. ********************************************************************************
. *** Randomization vs. choice (with three choice processes)
. ********************************************************************************
. ********************************************************************************
. 
. *** N for simulation (where we start with a large pseudo population)
. 
. set obs 1000000 
number of observations (_N) was 0, now 1,000,000

. 
. *** Set seed for reproducibility (Steve's birthday. Don't forget it!)
. 
. set seed 73071

. 
. ********************************************************************************
. *** Generate potential outcomes (fixed for individuals, regardless of type of
. ***   treatment assignment/selection)  
. ********************************************************************************
. 
. gen y0 = rnormal(100, 10)

. gen ite = rnormal(10, 1)

. gen y1 = y0 + ite

. 
. summ 

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
          y0 |  1,000,000    99.98396    9.999963   46.97079   145.7549
         ite |  1,000,000    9.998516    .9995069    4.93816   14.66574
          y1 |  1,000,000    109.9825    10.04932   58.21951   156.9191

. corr
(obs=1,000,000)

             |       y0      ite       y1
-------------+---------------------------
          y0 |   1.0000
         ite |  -0.0005   1.0000
          y1 |   0.9950   0.0990   1.0000


. 
. ********************************************************************************
. *** Generate observed data for random assignment to treatment
. ********************************************************************************
. 
. gen treat_rand = runiform(0, 1) > .5 /* or: gen treat_rand = rbinomial(1, .5) */

. gen y_rand =  treat_rand * y1 + (1 - treat_rand) * y0

. 
. ********************************************************************************
. *** Generate observed data for non-random selection into treatment
. ********************************************************************************
. 
. *** Generate common random noise variable for choices (fixed for individuals)
. 
. gen u = rnormal(0, 1)

. 
. *** Treatment selection: Positive selection on y0
. 
. gen treat_ch_y0 = [y0 + u > 100]

. gen y_ch_y0 =  treat_ch_y0 * y1 + (1 - treat_ch_y0) * y0

. 
. *** Treatment selection: Positve selection on y1
. 
. gen treat_ch_y1 = [y1 + u > 110]

. gen y_ch_y1 =  treat_ch_y1 * y1 + (1 - treat_ch_y1) * y0

. 
. *** Treatment selection: Positve selection on y1-y0
. 
. gen treat_ch_ite = [ite + u > 10]

. gen y_ch_ite =  treat_ch_ite * y1 + (1 - treat_ch_ite) * y0

. 
. ********************************************************************************
. *** Simulation results
. ********************************************************************************
. 
. *** Summarize the constructed data and treatment effects at the population level 
. 
. summ

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
          y0 |  1,000,000    99.98396    9.999963   46.97079   145.7549
         ite |  1,000,000    9.998516    .9995069    4.93816   14.66574
          y1 |  1,000,000    109.9825    10.04932   58.21951   156.9191
  treat_rand |  1,000,000     .499907    .5000002          0          1
      y_rand |  1,000,000    104.9822    11.20719   46.97079   156.9191
-------------+---------------------------------------------------------
           u |  1,000,000   -.0002538    1.000111  -4.568869   4.674278
 treat_ch_y0 |  1,000,000     .499646    .5000001          0          1
     y_ch_y0 |  1,000,000    104.9793    14.31372   46.97079   156.9191
 treat_ch_y1 |  1,000,000     .499332    .4999998          0          1
     y_ch_y1 |  1,000,000    105.0156    14.31397   46.97079   156.9191
-------------+---------------------------------------------------------
treat_ch_ite |  1,000,000     .500146    .5000002          0          1
    y_ch_ite |  1,000,000    105.2665    11.32372   55.84927   156.9191

. 
. mean y0 y1 ite y_rand, over(treat_rand)

Mean estimation                   Number of obs   =  1,000,000

            0: treat_rand = 0
            1: treat_rand = 1

--------------------------------------------------------------
        Over |       Mean   Std. Err.     [95% Conf. Interval]
-------------+------------------------------------------------
y0           |
           0 |      99.97       0.01         99.95      100.00
           1 |      99.99       0.01         99.97      100.02
-------------+------------------------------------------------
y1           |
           0 |     109.97       0.01        109.94      110.00
           1 |     109.99       0.01        109.96      110.02
-------------+------------------------------------------------
ite          |
           0 |      10.00       0.00         10.00       10.00
           1 |      10.00       0.00         10.00       10.00
-------------+------------------------------------------------
y_rand       |
           0 |      99.97       0.01         99.95      100.00
           1 |     109.99       0.01        109.96      110.02
--------------------------------------------------------------

. regress y_rand treat_rand

      Source |       SS           df       MS      Number of obs   = 1,000,000
-------------+----------------------------------   F(1, 999998)    >  99999.00
       Model |  25094386.7         1  25094386.7   Prob > F        =    0.0000
    Residual |   100506618   999,998  100.506819   R-squared       =    0.1998
-------------+----------------------------------   Adj R-squared   =    0.1998
       Total |   125601005   999,999   125.60113   Root MSE        =    10.025

------------------------------------------------------------------------------
      y_rand |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
  treat_rand |      10.02       0.02   499.68    0.00         9.98       10.06
       _cons |      99.97       0.01  7052.02    0.00        99.95      100.00
------------------------------------------------------------------------------

. 
. mean y0 y1 ite y_ch_y0, over(treat_ch_y0)

Mean estimation                   Number of obs   =  1,000,000

            0: treat_ch_y0 = 0
            1: treat_ch_y0 = 1

--------------------------------------------------------------
        Over |       Mean   Std. Err.     [95% Conf. Interval]
-------------+------------------------------------------------
y0           |
           0 |      92.05       0.01         92.03       92.06
           1 |     107.93       0.01        107.91      107.95
-------------+------------------------------------------------
y1           |
           0 |     102.05       0.01        102.03      102.06
           1 |     117.93       0.01        117.91      117.95
-------------+------------------------------------------------
ite          |
           0 |      10.00       0.00         10.00       10.00
           1 |      10.00       0.00          9.99       10.00
-------------+------------------------------------------------
y_ch_y0      |
           0 |      92.05       0.01         92.03       92.06
           1 |     117.93       0.01        117.91      117.95
--------------------------------------------------------------

. regress y_ch_y0 treat_ch_y0

      Source |       SS           df       MS      Number of obs   = 1,000,000
-------------+----------------------------------   F(1, 999998)    >  99999.00
       Model |   167469361         1   167469361   Prob > F        =    0.0000
    Residual |  37412891.9   999,998  37.4129667   R-squared       =    0.8174
-------------+----------------------------------   Adj R-squared   =    0.8174
       Total |   204882253   999,999  204.882458   Root MSE        =    6.1166

------------------------------------------------------------------------------
     y_ch_y0 |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
 treat_ch_y0 |      25.88       0.01  2115.71    0.00        25.86       25.91
       _cons |      92.05       0.01  1.1e+04    0.00        92.03       92.06
------------------------------------------------------------------------------

. 
. mean y0  y1 ite y_ch_y1, over(treat_ch_y1)

Mean estimation                   Number of obs   =  1,000,000

            0: treat_ch_y1 = 0
            1: treat_ch_y1 = 1

--------------------------------------------------------------
        Over |       Mean   Std. Err.     [95% Conf. Interval]
-------------+------------------------------------------------
y0           |
           0 |      92.09       0.01         92.07       92.11
           1 |     107.90       0.01        107.88      107.91
-------------+------------------------------------------------
y1           |
           0 |     102.01       0.01        101.99      102.03
           1 |     117.97       0.01        117.96      117.99
-------------+------------------------------------------------
ite          |
           0 |       9.92       0.00          9.92        9.92
           1 |      10.08       0.00         10.07       10.08
-------------+------------------------------------------------
y_ch_y1      |
           0 |      92.09       0.01         92.07       92.11
           1 |     117.97       0.01        117.96      117.99
--------------------------------------------------------------

. regress y_ch_y1 treat_ch_y1

      Source |       SS           df       MS      Number of obs   = 1,000,000
-------------+----------------------------------   F(1, 999998)    >  99999.00
       Model |   167487908         1   167487908   Prob > F        =    0.0000
    Residual |    37401524   999,998  37.4015988   R-squared       =    0.8175
-------------+----------------------------------   Adj R-squared   =    0.8175
       Total |   204889432   999,999  204.889637   Root MSE        =    6.1157

------------------------------------------------------------------------------
     y_ch_y1 |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
 treat_ch_y1 |      25.88       0.01  2116.15    0.00        25.86       25.91
       _cons |      92.09       0.01  1.1e+04    0.00        92.07       92.11
------------------------------------------------------------------------------

. 
. mean y0 y1 ite y_ch_y1, over(treat_ch_ite)

Mean estimation                   Number of obs   =  1,000,000

            0: treat_ch_ite = 0
            1: treat_ch_ite = 1

--------------------------------------------------------------
        Over |       Mean   Std. Err.     [95% Conf. Interval]
-------------+------------------------------------------------
y0           |
           0 |      99.98       0.01         99.96      100.01
           1 |      99.98       0.01         99.96      100.01
-------------+------------------------------------------------
y1           |
           0 |     109.42       0.01        109.39      109.45
           1 |     110.55       0.01        110.52      110.57
-------------+------------------------------------------------
ite          |
           0 |       9.43       0.00          9.43        9.44
           1 |      10.56       0.00         10.56       10.56
-------------+------------------------------------------------
y_ch_y1      |
           0 |     104.29       0.02        104.25      104.33
           1 |     105.74       0.02        105.70      105.78
--------------------------------------------------------------

. regress y_ch_ite treat_ch_ite

      Source |       SS           df       MS      Number of obs   = 1,000,000
-------------+----------------------------------   F(1, 999998)    >  99999.00
       Model |  27887200.9         1  27887200.9   Prob > F        =    0.0000
    Residual |   100339364   999,998  100.339565   R-squared       =    0.2175
-------------+----------------------------------   Adj R-squared   =    0.2175
       Total |   128226565   999,999  128.226693   Root MSE        =    10.017

------------------------------------------------------------------------------
    y_ch_ite |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
treat_ch_ite |      10.56       0.02   527.19    0.00        10.52       10.60
       _cons |      99.98       0.01  7056.94    0.00        99.96      100.01
------------------------------------------------------------------------------

. 
. *** Sample and estimate
. 
. sample 2500, count
(997,500 observations deleted)

. summ

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
          y0 |      2,500     100.182    10.05924   69.97447   139.1876
         ite |      2,500     10.0008    1.030834   5.606459   14.03656
          y1 |      2,500    110.1828    10.11603   79.62729   148.6992
  treat_rand |      2,500       .4848    .4998689          0          1
      y_rand |      2,500    105.0317     11.1521   71.42521   148.6992
-------------+---------------------------------------------------------
           u |      2,500   -.0015212    .9890912  -3.264152   3.185542
 treat_ch_y0 |      2,500       .4984    .5000975          0          1
     y_ch_y0 |      2,500    105.1779    14.38579   69.97447   148.6992
 treat_ch_y1 |      2,500       .5028    .5000922          0          1
     y_ch_y1 |      2,500    105.2571    14.38097   69.97447   148.6992
-------------+---------------------------------------------------------
treat_ch_ite |      2,500        .506     .500064          0          1
    y_ch_ite |      2,500     105.533    11.32705   71.05215   139.1876

. 
. mean y0 y1 ite y_rand, over(treat_rand)

Mean estimation                   Number of obs   =      2,500

            0: treat_rand = 0
            1: treat_rand = 1

--------------------------------------------------------------
        Over |       Mean   Std. Err.     [95% Conf. Interval]
-------------+------------------------------------------------
y0           |
           0 |     100.42       0.28         99.87      100.97
           1 |      99.93       0.29         99.36      100.49
-------------+------------------------------------------------
y1           |
           0 |     110.42       0.28        109.87      110.97
           1 |     109.93       0.29        109.36      110.50
-------------+------------------------------------------------
ite          |
           0 |      10.00       0.03          9.94       10.05
           1 |      10.00       0.03          9.94       10.06
-------------+------------------------------------------------
y_rand       |
           0 |     100.42       0.28         99.87      100.97
           1 |     109.93       0.29        109.36      110.50
--------------------------------------------------------------

. regress y_rand treat_rand

      Source |       SS           df       MS      Number of obs   =     2,500
-------------+----------------------------------   F(1, 2498)      =    554.17
       Model |  56430.3136         1  56430.3136   Prob > F        =    0.0000
    Residual |  254368.451     2,498  101.828844   R-squared       =    0.1816
-------------+----------------------------------   Adj R-squared   =    0.1812
       Total |  310798.765     2,499  124.369254   Root MSE        =    10.091

------------------------------------------------------------------------------
      y_rand |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
  treat_rand |       9.51       0.40    23.54    0.00         8.71       10.30
       _cons |     100.42       0.28   357.15    0.00        99.87      100.97
------------------------------------------------------------------------------

. 
. mean y0 y1 ite y_ch_y0, over(treat_ch_y0)

Mean estimation                   Number of obs   =      2,500

            0: treat_ch_y0 = 0
            1: treat_ch_y0 = 1

--------------------------------------------------------------
        Over |       Mean   Std. Err.     [95% Conf. Interval]
-------------+------------------------------------------------
y0           |
           0 |      92.21       0.17         91.88       92.54
           1 |     108.20       0.18        107.86      108.55
-------------+------------------------------------------------
y1           |
           0 |     102.19       0.17        101.86      102.52
           1 |     118.23       0.18        117.88      118.58
-------------+------------------------------------------------
ite          |
           0 |       9.98       0.03          9.92       10.03
           1 |      10.02       0.03          9.97       10.08
-------------+------------------------------------------------
y_ch_y0      |
           0 |      92.21       0.17         91.88       92.54
           1 |     118.23       0.18        117.88      118.58
--------------------------------------------------------------

. regress y_ch_y0 treat_ch_y0

      Source |       SS           df       MS      Number of obs   =     2,500
-------------+----------------------------------   F(1, 2498)      =  11226.27
       Model |  423038.695         1  423038.695   Prob > F        =    0.0000
    Residual |   94131.973     2,498  37.6829355   R-squared       =    0.8180
-------------+----------------------------------   Adj R-squared   =    0.8179
       Total |  517170.668     2,499  206.951048   Root MSE        =    6.1386

------------------------------------------------------------------------------
     y_ch_y0 |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
 treat_ch_y0 |      26.02       0.25   105.95    0.00        25.54       26.50
       _cons |      92.21       0.17   531.94    0.00        91.87       92.55
------------------------------------------------------------------------------

. 
. mean y0  y1 ite y_ch_y1, over(treat_ch_y1)

Mean estimation                   Number of obs   =      2,500

            0: treat_ch_y1 = 0
            1: treat_ch_y1 = 1

--------------------------------------------------------------
        Over |       Mean   Std. Err.     [95% Conf. Interval]
-------------+------------------------------------------------
y0           |
           0 |      92.19       0.17         91.86       92.52
           1 |     108.09       0.18        107.73      108.44
-------------+------------------------------------------------
y1           |
           0 |     102.10       0.17        101.77      102.42
           1 |     118.18       0.18        117.83      118.53
-------------+------------------------------------------------
ite          |
           0 |       9.91       0.03          9.85        9.96
           1 |      10.09       0.03         10.04       10.15
-------------+------------------------------------------------
y_ch_y1      |
           0 |      92.19       0.17         91.86       92.52
           1 |     118.18       0.18        117.83      118.53
--------------------------------------------------------------

. regress y_ch_y1 treat_ch_y1

      Source |       SS           df       MS      Number of obs   =     2,500
-------------+----------------------------------   F(1, 2498)      =  11147.56
       Model |  422212.423         1  422212.423   Prob > F        =    0.0000
    Residual |  94611.4604     2,498  37.8748841   R-squared       =    0.8169
-------------+----------------------------------   Adj R-squared   =    0.8169
       Total |  516823.883     2,499  206.812278   Root MSE        =    6.1543

------------------------------------------------------------------------------
     y_ch_y1 |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
 treat_ch_y1 |      25.99       0.25   105.58    0.00        25.51       26.47
       _cons |      92.19       0.17   528.13    0.00        91.85       92.53
------------------------------------------------------------------------------

. 
. mean y0 y1 ite y_ch_y1, over(treat_ch_ite)

Mean estimation                   Number of obs   =      2,500

            0: treat_ch_ite = 0
            1: treat_ch_ite = 1

--------------------------------------------------------------
        Over |       Mean   Std. Err.     [95% Conf. Interval]
-------------+------------------------------------------------
y0           |
           0 |     100.33       0.29         99.77      100.89
           1 |     100.03       0.28         99.48      100.59
-------------+------------------------------------------------
y1           |
           0 |     109.75       0.29        109.18      110.31
           1 |     110.61       0.28        110.05      111.17
-------------+------------------------------------------------
ite          |
           0 |       9.41       0.02          9.37        9.46
           1 |      10.58       0.02         10.53       10.62
-------------+------------------------------------------------
y_ch_y1      |
           0 |     104.67       0.40        103.89      105.46
           1 |     105.83       0.41        105.02      106.63
--------------------------------------------------------------

. regress y_ch_ite treat_ch_ite

      Source |       SS           df       MS      Number of obs   =     2,500
-------------+----------------------------------   F(1, 2498)      =    647.40
       Model |  65992.7208         1  65992.7208   Prob > F        =    0.0000
    Residual |  254634.272     2,498  101.935257   R-squared       =    0.2058
-------------+----------------------------------   Adj R-squared   =    0.2055
       Total |  320626.993     2,499  128.302118   Root MSE        =    10.096

------------------------------------------------------------------------------
    y_ch_ite |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
treat_ch_ite |      10.28       0.40    25.44    0.00         9.48       11.07
       _cons |     100.33       0.29   349.23    0.00        99.77      100.90
------------------------------------------------------------------------------

. 
. log close
      name:  <unnamed>
       log:  /Users/stephenmorgan/GitHub/steve-simulations/morgan-2-7-4-sim-01.log
  log type:  text
 closed on:  21 Aug 2020, 16:49:23
----------------------------------------------------------------------------------------------------
